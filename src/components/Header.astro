---
export interface Props {
  title?: string;
}

const { title = "Magyar Notes" } = Astro.props;
---

<header class="header" id="siteHeader">
  <div class="brand">
    <a href="/">{title}</a>
  </div>
  <nav class="nav">
    <a
      href="https://github.com/smurf11k/magyar-notes"
      target="_blank"
      rel="noopener noreferrer"
      class="navLink"
      aria-label="View on GitHub"
    >
      <svg
        class="icon"
        viewBox="0 0 24 24"
        fill="currentColor"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.463-1.11-1.463-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0112 6.836c.85.004 1.705.114 2.504.336 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.167 22 16.418 22 12c0-5.523-4.477-10-10-10z"
        ></path>
      </svg>
    </a>
    <button class="themeToggle" id="themeToggle" aria-label="Toggle theme">
      <svg
        class="icon sunIcon"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        xmlns="http://www.w3.org/2000/svg"
      >
        <circle cx="12" cy="12" r="5"></circle>
        <line x1="12" y1="1" x2="12" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="23"></line>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
        <line x1="1" y1="12" x2="3" y2="12"></line>
        <line x1="21" y1="12" x2="23" y2="12"></line>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
      </svg>
      <svg
        class="icon moonIcon"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
      </svg>
    </button>

    <button class="menuBtn" id="lessonsMenuBtn" aria-label="Open lessons menu">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M3 6h18M3 12h18M3 18h18"></path>
      </svg>
    </button>
  </nav>
</header>
<div class="overlay" id="lessonsOverlay" aria-hidden="true">
  <div
    class="overlayPanel"
    role="dialog"
    aria-modal="true"
    aria-label="Lessons"
  >
    <div class="overlayTop">
      <div class="overlayTitle">Lessons</div>
      <button class="closeBtn" data-close-overlay aria-label="Close">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M18 6L6 18M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- content is injected from LessonLayout (TreeView) -->
    <div class="overlayBody" id="lessonsOverlayBody"></div>
  </div>
</div>

<style>
  .header {
    padding: 18px 22px;
    border-bottom: 2px solid var(--border);
    /*border-bottom: none;*/
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--surface-dark);
    backdrop-filter: var(--surface-blur);
    -webkit-backdrop-filter: var(--surface-blur);
    position: sticky;
    top: 0;
    z-index: 10;
    transition:
      background 0.3s ease,
      backdrop-filter 0.3s ease;
  }

  /* Light theme header */
  :global([data-theme="light"]) .header {
    background: var(--surface-light);
  }

  /* Scrolled state - more blur and transparency */
  .header.scrolled {
    background: var(--surface-dark);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }

  :global([data-theme="light"]) .header.scrolled {
    background: var(--surface-light);
  }

  .brand {
    font-weight: 800;
    color: #f3f3f3;
  }

  :global([data-theme="light"]) .brand {
    color: #0f0f0f;
  }

  .brand a {
    color: inherit;
    text-decoration: none;
  }

  .nav {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .navLink {
    color: var(--muted);
    transition:
      color 0.2s ease,
      transform 0.15s ease;
    display: flex;
    align-items: center;
    text-decoration: none;
  }

  .navLink:hover {
    color: var(--accent);
    transform: translateY(-1px);
  }

  .themeToggle {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--muted);
    transition:
      color 0.2s ease,
      background 0.15s ease,
      transform 0.15s ease;
    border-radius: 8px;
  }

  .themeToggle:hover {
    color: var(--accent);
    background: rgba(249, 115, 22, 0.1);
    transform: translateY(-1px);
  }

  .icon {
    width: 20px;
    height: 20px;
    stroke-width: 2;
  }

  .sunIcon {
    display: none;
  }

  .moonIcon {
    display: block;
  }

  /* Light theme */
  :global([data-theme="light"]) .sunIcon {
    display: block;
  }

  :global([data-theme="light"]) .moonIcon {
    display: none;
  }

  .menuBtn {
    display: none;
    background: none;
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 8px;
    color: var(--muted);
  }

  @media (max-width: 1040px) {
    .menuBtn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
  }

  /* full-screen overlay */
  .overlay {
    position: fixed;
    inset: 0;
    z-index: 999;
    display: none;
    background: rgba(0, 0, 0, 0.55);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  :global([data-theme="light"]) .overlay {
    background: rgba(0, 0, 0, 0.35);
  }

  .overlay.open {
    display: block;
  }

  .overlayPanel {
    position: absolute;
    inset: 0;
    background: var(--bg);
    border-left: 1px solid var(--border);
    display: flex;
    flex-direction: column;
  }

  .overlayTop {
    height: 64px;
    padding: 0 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border);
  }

  .overlayTitle {
    font-weight: 800;
  }

  .closeBtn {
    background: none;
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 8px;
    color: var(--muted);
  }

  .overlayBody {
    padding: 14px 14px 24px;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* only mobile uses overlay; desktop keeps your existing layout */
  @media (min-width: 1041px) {
    .overlay {
      display: none !important;
    }
  }
</style>

<script>
  // Theme toggle functionality
  const toggle = document.getElementById("themeToggle");

  // Check for saved theme preference or default to 'dark'
  const currentTheme = localStorage.getItem("theme") || "dark";
  document.documentElement.setAttribute("data-theme", currentTheme);

  toggle?.addEventListener("click", () => {
    const theme = document.documentElement.getAttribute("data-theme");
    const newTheme = theme === "dark" ? "light" : "dark";

    document.documentElement.setAttribute("data-theme", newTheme);
    localStorage.setItem("theme", newTheme);
  });

  // Scroll effect for blur/transparency
  const header = document.querySelector(".header");
  let lastScroll = 0;

  window.addEventListener(
    "scroll",
    () => {
      const currentScroll = window.scrollY;

      if (currentScroll > 50) {
        header?.classList.add("scrolled");
      } else {
        header?.classList.remove("scrolled");
      }

      lastScroll = currentScroll;
    },
    { passive: true },
  );
</script>

<script>
  (() => {
    const btn = document.getElementById("lessonsMenuBtn");
    const overlay = document.getElementById("lessonsOverlay");

    const lockScroll = (on: boolean) => {
      document.documentElement.classList.toggle("noScroll", on);
      document.body.classList.toggle("noScroll", on);
    };

    const open = () => {
      if (!overlay) return;
      overlay.classList.add("open");
      overlay.setAttribute("aria-hidden", "false");
      lockScroll(true);
    };

    const close = () => {
      if (!overlay) return;
      overlay.classList.remove("open");
      overlay.setAttribute("aria-hidden", "true");
      lockScroll(false);
    };

    btn?.addEventListener("click", open);

    overlay?.addEventListener("click", (e: MouseEvent) => {
      // click outside panel closes
      if (e.target === overlay) close();
    });

    overlay?.querySelectorAll("[data-close-overlay]").forEach((x) => {
      x.addEventListener("click", close);
    });

    document.addEventListener("keydown", (e: KeyboardEvent) => {
      if (e.key === "Escape") close();
    });

    // close if you rotate / resize into desktop
    window.addEventListener("resize", () => {
      if (window.matchMedia("(min-width: 1041px)").matches) close();
    });
  })();
</script>
